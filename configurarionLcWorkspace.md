# Настройка Логин Центра и воркспейса, установленных на одном сервере:

Сначала устанавливаем Логин Центр и воркспейс, по соответствующим инструкциям в Содержании.

[Чистая установка Логин Центра](cleanInstallationLc.md)

[Чистая установка дистрибутива воркспейса Optimacros](cleanInstallation.md)

После того как мы установили Логин Центра и Воркспейс.
Для начала нам необходимо в Логин Центре в файлике под названием .env, добавить переменную `WORKSPACE_PROXY_URL` и 
указать ей значение: `http://10.0.3.15` (Это тот самый container.ip который мы указывали в файлике manifest.json при 
его заполнении)

![](./pictures/addedVariable.png)

Далее нам необходимо залить на сервер templates, чтобы воспользоваться нашими переменными окружения, они находятся на 
nextcloud'е:

![](./pictures/templates.png)

Скачиваем их себе на компьютер для дальнейшего редактирования, исправляя моменты, которые у нас изменились согласно 
окружению и добавляем templates на сервер.

Переходим в терминале в директорию `login-center/data/nginx/templates`

Набираем команду: `nano ws80.conf.template` и вставляем содержимое скачанного темплейта в терминал. 

![](./pictures/ws80Conf.png)

После чего сохраняем файл.

Затем набираем команду `nano ws443.conf.template`

Открываем на компьютере содержимое скачанного из Nextcloud файла `ws443.conf.template` изменяем названия файлов 
наших сертификатов в соответствии с тем какие у нас в директории `login-center/data/nginx/sert` 

![](./pictures/ws443.png)

И изменяем пути к файлам сертификатов на соответствующие

![](./pictures/sertPath.png)

Вставляем содержимое в создаваемый на сервере файл `ws443.conf.template` и сохраняем содержимое.

Аналогичным образом открываем скачанный файл `ws8081.conf.template` и редактируем в нём имена и пути к файлам 
сертификатов и так как мы решили оставить ан ssl только Логин Центр изменяем порт с 8081 на 8080 в location в proxy_pass

![](./pictures/ws8081.png)

Создаём файл `ws8081.conf.template` на сервере и вставляем в него содержимое нашего отредактированного файла 
`ws8081.conf.template`

Далее создаём файл `ws8080.conf.template` и помещаем содержимое скачанного файла с соответствующим названием, в 
неизменном виде.

Затем нам необходимо сделать стоп\старт Логин Центра, перейдя в его root директорию и воспользовавшись утилитой `om`, 
используя команды `./om stop` и затем `./om start`

С настройкой Логин Центра пока заканчиваем и переходим к настройке файла воркспейса `manifest.json`

Для начала остановим работу воркспейса при помощи команды:

```/om/workspace-installer/current/install workspace --path /om/workspace1/manifest.json shutdown```

В первую очередь, что нам нужно изменить относительно стандартного файла манифеста это свойство `dns` для того, в ОС 
Ubuntu узнать список имеющихся DNS можно воспользоваться командой `systemd-resolve --status` после чего курсором на 
клавиатуре скроллим вывод команды в самый низ и смотрим список DNS Servers:

![](./pictures/outputDnsUbuntu.png)

То содержимое, которые мы наблюдаем в `DNS Servers:` помещаем в массив объектов с ключом `ip` и текстовым значением DNS
 по пути `container.dns.nameServers` (обязательно соблюдаем порядок перечисления DNS), а то что в `DNS Domain:` помещаем
  в массив строк по пути `container.dns.search` в файле манифеста. Свойство `container` в манифесте будет выглядеть 
  примерно вот так:
  
![](./pictures/manifestContainer.png)

Возобновляем работу воркспейса при помощи команды:

```/om/workspace-installer/current/install workspace --path /om/workspace1/manifest.json up```

На этом всё. Это всё что нужно сконфигурировать, для работы Логин Центра и воркспейса на одном сервере. 

[Вернуться к содержанию <](contents.md)

[Вернуться к оглавлению <<](index.md)
